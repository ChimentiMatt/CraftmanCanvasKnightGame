var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(){CMLoader=function(){void 0===Object.assign&&(Object.assign=function(a,b){if(!b)return a;for(var c in b)a[c]=b[c];return a}),this.loading=0,this.set=1,this.JsFiles=[{src:"js/lib/easeljs.combined.js"},{src:"js/lib/CMP.js"},{src:"js/lib/CMP.Text.js"},{src:"js/lib/CMP.Tween.js"},{src:"js/lib/CMP.DisplayObject.js"},{src:"js/lib/CMP.DisplayObjectContainer.js"},{src:"js/lib/CMP.CachedContainer.js"},{src:"js/lib/CMP.Sprite.js"},{src:"js/lib/CMP.SizedSprite.js"},{src:"js/lib/CMP.SpriteSheet.js"},{src:"js/lib/CMP.AudioManager.js"},{src:"js/lib/CMP.Audio.js"},{src:"js/lib/CMP.PartnerAdapter.js"}],this.onSetLoads=[],this.aSyncJs=[{src:"js/lib/CMP.Window.js"},{src:"js/lib/CMP.Overlay.js"}],this.loadAppConfig()},CMLoader.prototype={loadAppConfig:function(){this.loadJsFile({src:"js/AppConfig.js"},this.loadMandatory.bind(this))},loadMandatory:function(){if("undefined"==typeof AppConfig)return void CMP.Log(CMP.Log.ERROR,"Could not find AppConfig");if(AppConfig&&AppConfig.ENGINE_MIN&&(this.JsFiles=[{src:"js/lib/easeljs.min.js"},{src:"js/lib/cmp.min.js"}],this.aSyncJs=[]),AppConfig&&AppConfig.PLUGINS)for(var a=0;a<AppConfig.PLUGINS.length;a++)this.JsFiles.push({src:"js/lib/plugins/"+AppConfig.PLUGINS[a]});if(AppConfig&&AppConfig.DevFiles)for(var b=0;b<AppConfig.DevFiles.length;b++)this.JsFiles.push({src:"js/lib/dev/"+AppConfig.DevFiles[b]});this.loadSync(this.JsFiles,"JsFile",this.loadRest.bind(this))},loadRest:function(){this.addPluginPlaceholders(),CMP.Log(CMP.Log.EXTRA,"Loaded CMP library."),new CMP.App,CMP.CreateLoadingOverlay(),setTimeout(this.callProcessApp.bind(this),10)},callProcessApp:function(){this.loadASync(this.aSyncJs,"JsFile",this.processAppConfig.bind(this))},addPluginPlaceholders:function(){var a=function(){return{progress:function(){}}};void 0===CMP.Heat&&(CMP.Heat=a),void 0===CMP.HeatViewer&&(CMP.HeatViewer=a)},deepCopy:function(a){var b,c,d;b=Array.isArray(a)?[]:{};for(d in a)c=a[d],b[d]="object"===(void 0===c?"undefined":_typeof(c))?this.deepCopy(c):c;return b},processAppConfig:function(){if("undefined"!=typeof AppConfig){var a=function(a){0==--b&&(CMP.RemoveLoadingOverlay(),CMP.App.GLOBALSPRITESHEET=new CMP.SpriteBatch({images:Object.keys(CMP.App.assetManager.images)}),this.launchApp())},b=0;if(AppConfig.CUSTOMIZABLE){for(var c=0;c<AppConfig.CUSTOMIZABLE.length;c++)AppConfig.CUSTOMIZABLE[c].src="assets/images/customizable/"+AppConfig.CUSTOMIZABLE[c].src;AppConfig.Image=AppConfig.Image.concat(AppConfig.CUSTOMIZABLE)}if(AppConfig.CUSTOMIZABLE_VID){for(var d=0;d<AppConfig.CUSTOMIZABLE_VID.length;d++)AppConfig.CUSTOMIZABLE_VID[d].src="assets/videos/customizable/"+AppConfig.CUSTOMIZABLE_VID[d].src;AppConfig.Video=AppConfig.Video.concat(AppConfig.CUSTOMIZABLE_VID)}if(AppConfig.CUSTOMIZABLE_AUDIO){for(var e=0;e<AppConfig.CUSTOMIZABLE_AUDIO.length;e++)AppConfig.CUSTOMIZABLE_AUDIO[e].ogg&&(AppConfig.CUSTOMIZABLE_AUDIO[e].ogg="assets/audio/customizable/"+AppConfig.CUSTOMIZABLE_AUDIO[e].ogg),AppConfig.CUSTOMIZABLE_AUDIO[e].mp3="assets/audio/customizable/"+AppConfig.CUSTOMIZABLE_AUDIO[e].mp3;AppConfig.Audio=AppConfig.Audio.concat(this.deepCopy(AppConfig.CUSTOMIZABLE_AUDIO))}if(AppConfig.CUSTOMIZABLE_FONT){for(var f=0;f<AppConfig.CUSTOMIZABLE_FONT.length;f++)AppConfig.CUSTOMIZABLE_FONT[f].src="assets/fonts/customizable/"+AppConfig.CUSTOMIZABLE_FONT[f].src;AppConfig.Font=AppConfig.Font.concat(AppConfig.CUSTOMIZABLE_FONT)}for(var g=["JsFile","Image","Audio","Font","Video"],h=0;h<g.length;h++)i=g[h],AppConfig[i]&&(b++,"JsFile"==i&&AppConfig.PRODUCTION?(CMP.Log(CMP.Log.EXTRA,"Loading game code from game.min.js (PRODUCTION == true) "),this.loadASync([{src:"js/game/game.min.js"}],i,a.bind(this,i))):(CMP.Log(CMP.Log.EXTRA,"Firing load request for assets defined in AppConfig",i),this.loadASync(AppConfig[i],i,a.bind(this,i))))}},launchApp:function(){"undefined"==typeof Playable?CMP.Log(CMP.Log.ERROR,"Could not find Playable class"):(CMP.Log(CMP.Log.NOTICE,"Launching Playable class"),CMP.Loader=this,this.loadNextSet(),CMP._playableInstance=new Playable,CMP.Dispatch({type:"AutomateTesting"}))},requireLoad:function(a,b){if(CMP.Log(CMP.Log.NOTICE,"Checking if asset list",a,"is loaded before proceeding."),"number"==typeof a){if(this.set>a)return CMP.Log(CMP.Log.EXTRA,"Asset list",a,"is loaded."),void("function"==typeof b&&b());if(!AppConfig.DEFERRED["set"+a])return CMP.Log(CMP.Log.EXTRA,"Trying to load set list that doesnt exist."),CMP.Log(CMP.Log.ALL,"Calling callback right away."),void("function"==typeof b&&b());CMP.Log(CMP.Log.EXTRA,"Waiting on",a,"to be loaded, currently only completed up to set",this.set-1),CMP.CreateLoadingOverlay(),this.onSetLoads[a]?this.onSetLoads[a].push(b):this.onSetLoads[a]=[b]}else AppConfig.DEFERRED[a]?AppConfig.DEFERRED[a].loaded?(CMP.Log(CMP.Log.EXTRA,"Custom asset list",a,"is loaded."),"function"==typeof b&&b()):(AppConfig.DEFERRED[a].loading||(CMP.Log(CMP.Log.EXTRA,"Custom asset list",a,"was not loaded. Loading now"),AppConfig.DEFERRED[a].loading=!0,this.loadASync(AppConfig.DEFERRED[a],"Image",this.finishedLoadingCustom.bind(this,a))),CMP.Log(CMP.Log.NOTICE,"Waiting on custom list",a),this.onSetLoads[a]?this.onSetLoads[a].push(b):this.onSetLoads[a]=[b],CMP.CreateLoadingOverlay()):(CMP.Log(CMP.Log.ERROR,"Failed to find custom asset list",a),"function"==typeof b&&b())},finishedLoadingCustom:function(a){CMP.Log(CMP.Log.NOTICE,"Finished loading custom list",a),AppConfig.DEFERRED[a].loaded=!0;for(var b=0;b<this.onSetLoads[a].length;b++)"function"==typeof this.onSetLoads[a][b]&&this.onSetLoads[a][b]();this.onSetLoads[a]=!1,this.checkSetsLoaded()},loadNextSet:function(){this.set++;for(var a=0;a<this.set;a++)if(this.onSetLoads[a]){CMP.Log(CMP.Log.ALL,"Calling uncalled callbacks of ",a);for(var b=0;b<this.onSetLoads[a].length;b++)"function"==typeof this.onSetLoads[a][b]&&this.onSetLoads[a][b]();this.onSetLoads[a]=!1,this.checkSetsLoaded()}AppConfig.DEFERRED&&AppConfig.DEFERRED["set"+this.set]&&(CMP.Log(CMP.Log.EXTRA,"Auto loading next set list",this.set),this.loadASync(AppConfig.DEFERRED["set"+this.set],"Image",this.loadNextSet.bind(this)))},checkSetsLoaded:function(){CMP.Log(CMP.Log.ALL,"Checking if waiting on any sets to load");for(var a in this.onSetLoads)if(this.onSetLoads[a])return void CMP.Log(CMP.Log.ALL,"Still waiting on set",a);CMP.RemoveLoadingOverlay()},load:function(a){var b=a.type,c=a.config,d=a.callback;d="function"==typeof d?d:function(){},"function"==typeof this["load"+b]?("undefined"!=typeof CMP&&CMP.Log(CMP.Log.ALL,"Attempting to load file type:",b),this["load"+b].call(this,c,d)):"undefined"!=typeof CMP&&CMP.Log(CMP.Log.ERROR,"Failed to load type:",b)},loadImage:function(a,b){CMP.Log(CMP.Log.ALL,"Loading image from",a.src);var c=new Image;a.img=c;var d=this.onload.bind(this,"Image",a,b);a.loaded=!1;var e={config:a,loaded:!1,callback:d};c.onload=this.onAssetLoaded.bind(this,e),c.onerror=this.onFailedLoad.bind(this,e),setTimeout(this.loadTimeout.bind(this,e),3e4),c.src=a.src},loadVideo:function(a,b){function c(a){a||(e=!1),0==--d&&(e?this.onAssetLoaded(g):this.onFailedLoad(g))}var d=0,e=!0,f=this.onload.bind(this,"Video",a,b),g={config:a,loaded:!1,callback:f};setTimeout(this.loadTimeout.bind(this,g),3e4),a.loaded=!1,a.count=a.count?a.count:1,a.videoLoaders=[];for(var h="Android"===CMP.getMobileOS()?2:1,i=0;i<a.count*h;i++){"Android"===CMP.getMobileOS()?new CMP.VideoAndroid({uniqueID:i,config:a,onComplete:c.bind(this,!0),onError:c.bind(this,!1)}):"iOS"===CMP.getMobileOS()?new CMP.VideoIOS({uniqueID:i,config:a,onComplete:c.bind(this,!0),onError:c.bind(this,!1)}):new CMP.VideoDesktop({uniqueID:i,config:a,onComplete:c.bind(this,!0),onError:c.bind(this,!1)});d++}},loadAudio:function(a,b){function c(a){a||(e=!1),0==--d&&(e?this.onAssetLoaded(g):this.onFailedLoad(g))}var d=0,e=!0,f=this.onload.bind(this,"Audio",a,b),g={config:a,loaded:!1,callback:f};setTimeout(this.loadTimeout.bind(this,g),3e4),a.loaded=!1,a.count=a.count?a.count:1,a.audioLoaders=[];for(var h=0;h<a.count;h++){new CMP.AudioManager({config:a,onComplete:c.bind(this,!0),onError:c.bind(this,!1)});d++}},checkDuplicateFont:function(a){this.fontsLoaded||(this.fontsLoaded={});var b=a.fontFamily||a.id;return!!this.fontsLoaded[b]||(this.fontsLoaded[b]=!0,!1)},checkNecessaryFont:function(a){if("undefined"!=typeof SCENE_CONFIG){if(!this.fontsRequired){this.fontsRequired=[];for(var b in SCENE_CONFIG){var c=SCENE_CONFIG[b];for(var d in c.children){var e=c.children[d];this.getFontsInLayer(e)}}}if(-1===this.fontsRequired.indexOf(a.fontFamily))return!1}return!0},getFontsInLayer:function(a){if("Font"===a.type){var b=a.config.family;-1===this.fontsRequired.indexOf(b)&&this.fontsRequired.push(b)}if("GroupObject"===a.type)for(var c in a.children)this.getFontsInLayer(a.children[c])},loadFont:function(a,b){if(!this.checkNecessaryFont(a)||this.checkDuplicateFont(a))return void b();var c=new CMP.Font;c.fontFamily=a.fontFamily||a.id;var d=this.onload.bind(this,"Font",a,b);a.loaded=!1;var e={config:a,loaded:!1,callback:d};if(c.onload=this.onAssetLoaded.bind(this,e),c.onerror=this.onFailedLoad.bind(this,e),setTimeout(this.loadTimeout.bind(this,e),3e4),c.src=a.src,a.font=c,"undefined"!=typeof InstallTrigger){var f=document.createElement("style");f.appendChild(document.createTextNode("                @font-face {                    font-family: "+c.fontFamily+";                    src: url('"+a.src+"')                }                ")),document.head.appendChild(f)}},onFailedLoad:function(a){CMP.Log(CMP.Log.ERROR,"Failed to load asset",a.config.id),a.config.error=!0,a.counted||(a.counted=!0,a.callback())},onAssetLoaded:function(a){CMP.Log(CMP.Log.ALL,"Finished loading asset from",a.config.id),a.config.loaded=!0,a.counted||(a.counted=!0,a.callback())},loadTimeout:function(a){a.counted||(CMP.Log(CMP.Log.ERROR,"Failed to load asset in time",a.config.id),a.config.loaded=!1,a.callback(),a.counted=!0)},loadJsFile:function(a,b){b="function"==typeof b?b:function(){};var c=document.createElement("script");c.onload=b,c.onerror=b,c.src=a.src,document.head.appendChild(c)},loadSync:function(a,b,c){if(c="function"==typeof c?c:function(){},void 0===a||a.length<=0)return void c();var d=a.shift();this.load({type:b,config:d,callback:this.loadSync.bind(this,a,b,c)})},loadASync:function(a,b,c){function d(a){0==--e&&c()}if("undefined"!=typeof AppConfig&&AppConfig.JS_DEPENDENCIES&&"JsFile"===b)return void this.loadSync(a,b,c);if(c="function"==typeof c?c:function(){},void 0===a||a.length<=0)return void c();for(var e=0,f=0;f<a.length;f++)e++,this.load({type:b,config:a[f],callback:d.bind(this,a[f])})},onload:function(a,b,c){switch(a){case"Image":case"Audio":case"Font":case"Video":CMP.App.addAsset(a,b),c()}}},Log=function(a,b){if("undefined"!=typeof AppConfig&&"number"==typeof AppConfig.LOG_LEVEL&&"number"==typeof a&&AppConfig.LOG_LEVEL>=a)if("string"!=typeof b&&b){if(b.type)switch(type){case"error":console.error("CMP Error:",b.text);case"warning":console.log("CMP Warning:",b.text);default:console.log("CMP:",b.text)}}else{var c=Array.prototype.slice.call(arguments);c.shift();var d=c.join(" ");console.log("CMP:",d)}else{var c=Array.prototype.slice.call(arguments);c.shift();var e=c.join(" ");console.log("CMP:",e)}};new CMLoader}();