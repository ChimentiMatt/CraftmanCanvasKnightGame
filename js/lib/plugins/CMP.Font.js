var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(a){function b(){this.fontFamily="fjs"+(999999*Math.random()|0)}if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";!function(a){function b(a,b){return this.slice(a,b)}function c(a,b){var c,d=a.length;for(arguments.length<2&&(b=0),c=0;c<d;++c,++b)this[b]=255&a[c]}function d(a){var d,e;if("number"==typeof a)for(d=new Array(a),e=0;e<a;++e)d[e]=0;else d=a.slice(0);return d.subarray=b,d.buffer=d,d.byteLength=d.length,d.set=c,"object"===(void 0===a?"undefined":_typeof(a))&&a.buffer&&(d.buffer=a.buffer),d}try{new Uint8Array(1);return}catch(a){}a.Uint8Array=d,a.Uint32Array=d,a.Int32Array=d}(a),function(a){if(!a.opera&&!("response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype)){var b;b=a.VBArray?function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}:function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:b})}}(a),a.btoa||(a.btoa=function(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do{b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h)}while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)}),b.prototype.url="",b.prototype.format="",b.prototype.data="",b.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",b.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},b.prototype.systemfont=!1,b.prototype.loaded=!1,b.prototype.onload=function(){},b.prototype.onerror=function(){},b.prototype.canvas=!1,b.prototype.context=!1,b.prototype.validate=function(a,b,c,d,e){if(!1!==e&&e<0)return void this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed).");getComputedStyle(a,null).getPropertyValue("width").replace("px","")>0?(document.head.removeChild(b),document.body.removeChild(a),this.loaded=!0,this.onload()):(console.log("timing out"),setTimeout(function(){d.validate(a,b,c,d,!1!==e&&e-50)},1e3))},b.prototype.ondownloaded=function(){var a=this,b=function(a){return String.fromCharCode(a)},c=function(a){if(a<256)return b(0)+b(a);var c=a>>8,d=255&a;return b(c)+b(d)},d=function(a,b){return 256*a+b},e=function(a,b){var c,d=a>>7==1;return a&=127,c=256*a+b,d?c-32768:c},f=function(a,b,c,d){return 16777216*a+65536*b+256*c+d},g=function(b){a.onerror(b)},h=b(0)+b(1)+b(0)+b(0),i="OTTO",j=this.data,k=b(j[0])+b(j[1])+b(j[2])+b(j[3]),l=k===h,m=!l&&k===i;if(l)this.format="truetype";else{if(!m)return void g("Error: file at "+this.url+" cannot be interpreted as OpenType font.");this.format="opentype"}var n,o,p=d(j[4],j[5]),q=12,r=q+16*p,s={};for(n=q;n<r;n+=16)o=b(j[n])+b(j[n+1])+b(j[n+2])+b(j[n+3]),s[o]={name:o,checksum:f(j[n+4],j[n+5],j[n+6],j[n+7]),offset:f(j[n+8],j[n+9],j[n+10],j[n+11]),length:f(j[n+12],j[n+13],j[n+14],j[n+15])};var t=function(a){return s[a]?a:(g("Error: font is missing the required OpenType '"+a+"' table."),!1)};if(!1!==(o=t("head"))){n=s[o].offset,s[o].version=""+j[n]+j[n+1]+j[n+2]+j[n+3];var u=d(j[n+18],j[n+19]);if(this.metrics.quadsize=u,!1!==(o=t("hhea"))&&(n=s[o].offset,s[o].version=""+j[n]+j[n+1]+j[n+2]+j[n+3],this.metrics.ascent=e(j[n+4],j[n+5])/u,this.metrics.descent=e(j[n+6],j[n+7])/u,this.metrics.leading=e(j[n+8],j[n+9])/u,!1!==(o=t("OS/2"))&&(n=s[o].offset,s[o].version=""+j[n]+j[n+1],this.metrics.weightclass=d(j[n+4],j[n+5]),!1!==(o=t("cmap"))))){n=s[o].offset,s[o].version=""+j[n]+j[n+1],p=d(j[n+2],j[n+3]);for(var v,w,x,y,z,A=!1,v=0;v<p;v++)w=n+4+8*v,x=d(j[w],j[w+1]),y=d(j[w+2],j[w+3]),z=f(j[w+4],j[w+5],j[w+6],j[w+7]),3===x&&1===y&&(A=z);var B="A";if(!1!==A&&(n+=A,4===(k=d(j[n],j[n+1])))){for(var C=d(j[n+6],j[n+7])/2,D=function(a){return-1===[9,10,11,12,13,32,127,128,129,141,142,143,144,149,157,158,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8232,8233,8234,8235,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,12288].indexOf(a)},E=n+14,F=n+14+2*C,G=!1;E<F&&(G=d(j[E],j[E+1]),!D(G));E+=2)G=!1;if(0!=G){B=String.fromCharCode(G);var H=(65536-(G-1))%65536,I=b(0)+c(G)+c(65535)+c(0)+c(G)+c(65535)+c(H)+c(1),J=btoa(I);this.base64=this.base64.substring(0,380)+J+this.base64.substring(380+J.length),console.log("this.base64 is",this.base64)}}this.bootstrapValidation(B,!1)}}},b.prototype.bootstrapValidation=function(a,b){console.log("in bootstrapValidation");var c=this.fontFamily+" testfont",d=document.createElement("style");d.setAttribute("type","text/css"),d.innerHTML="@font-face {\n  font-family: '"+c+"';\n  src: url(data:font/truetype;charset=utf-8;base64,"+this.base64+"')\n       format('truetype');}",document.head.appendChild(d);var e=!1;console.log("systemfont is",this.systemfont),e=this.toStyleNode(),document.head.appendChild(e);var f=document.createElement("p");if(f.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",f.style.fontFamily="'"+this.fontFamily+"', '"+c+"'",f.innerHTML=a+a+a+a+a+a+a+a+a+a,document.body.appendChild(f),"undefined"==typeof getComputedStyle)this.onload(),error("Error: getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var g=this.systemfont?1e3:this.metrics.quadsize,h=document.createElement("canvas");h.width=g,h.height=g,this.canvas=h;var i=h.getContext("2d");i.font="1em '"+this.fontFamily+"'",i.fillStyle="white",i.fillRect(-1,-1,g+2,g+2),i.fillStyle="black",i.fillText("test text",50,g/2),this.context=i;var j=this,k=function(){j.validate(f,d,e,j,b)};setTimeout(k,50)}},b.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},b.prototype.loadFont=function(){console.log("in loadFont");var a=this;if(console.log("this.url",this.url),this.newFontData=this.url,-1===this.url.indexOf("https"))return void setTimeout(function(){a.processSystemFont()},10);var b=new XMLHttpRequest;b.open("GET",a.url,!0),b.responseType="arraybuffer",b.onload=function(c){console.log("in xhr onload evt");var d=b.response;if(d){a.data=new Uint8Array(d);var e=new Uint8Array(d),f=Array.prototype.map.call(e,function(a){return String.fromCharCode(a)}).join("");this.newFontData=btoa(f),a.ondownloaded()}else a.onerror("Error downloading font resource from "+a.url)}.bind(this),b.onerror=function(b){a.onerror("Error downloading font resource from "+a.url)},b.send(null)},b.prototype.styleNode=!1,b.prototype.toStyleNode=function(){if(console.log("in tostylenode"),this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css";var a="@font-face {\n";return a+="  font-family: '"+this.fontFamily+"';\n",console.log("NEW FONT DATA",this.newFontData),a+="  src: url(data:font/truetype;charset=utf-8;base64,"+this.newFontData+") format('"+this.format+"');\n",this.styleNode.innerHTML=a,this.styleNode},b.prototype.measureText=function(a,b){if(!this.loaded)return this.onerror("measureText() was called while the font was not yet loaded"),!1;this.context.font=b+"px '"+this.fontFamily+"'";var c=this.context.measureText(a);c.fontsize=b,c.ascent=0,c.descent=0,c.bounds={minx:0,maxx:c.width,miny:0,maxy:0},c.height=0;var d=[];c.width,this.metrics.quadsize;d.push(a);var e,f=d.length;for(e=0;e<f;e++)this.measureSegment(d[e],b,c);return c},b.prototype.measureSegment=function(a,b,c){var d,e=function(a,b){return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)},f=document.createElement("div");f.style.position="absolute",f.style.opacity=0,f.style.font=b+"px '"+this.fontFamily+"'";var g=10;for(f.innerHTML=a,d=1;d<g;d++)f.innerHTML+="<br/>"+a;document.body.appendChild(f),c.leading=1.2*b;var h=e(f,"height");if(h=h.replace("px",""),h>=b*g&&(c.leading=h/g|0),document.body.removeChild(f),/^\s*$/.test(a))return c;var i=(this.canvas,this.context),j=this.systemfont?1e3:this.metrics.quadsize,k=j,l=j,m=j/2,n=50,o=(j-c.width)/2;o!==(0|o)&&(o|=0),i.fillStyle="white",i.fillRect(-n,-n,k+2*n,l+2*n),i.fillStyle="black",i.fillText(a,o,m);for(var p=c.width+n|0,q=4*b,r=o-n/2,s=m-q/2,t=i.getImageData(r,s,p,q).data,d=0,u=0,v=4*p,w=t.length,x=q/2;++d<w&&255===t[d];);var y=d/v|0;for(d=w-1;--d>0&&255===t[d];);var z=d/v|0;for(d=0,u=0;u<p&&255===t[d];)(d+=v)>=w&&(u++,d=d-w+4);var A=u,B=1;for(d=w-3,u=0;u<p&&255===t[d];)(d-=v)<0&&(u++,d=w-3-4*B++);var C=p-u;return c.ascent=x-y,c.descent=z-x,c.bounds={minx:A-n/2,maxx:C-n/2,miny:-c.descent,maxy:c.ascent},c.height=z-y+1,c},Object.defineProperty(b.prototype,"src",{set:function(a){this.url=a,this.loadFont()}}),"undefined"!=typeof define?define(function(){return b}):a.Font=b}(window);