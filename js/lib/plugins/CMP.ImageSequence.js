CMP.ImageSequence=function(a){this.construct(a),this._currentFrame=0,this._playing="boolean"==typeof this._playing&&this._playing,this.addZero="boolean"==typeof this.addZero&&this.addZero,this.loop=this.loop?this.loop:1,this.fps="number"!=typeof this.fps?24:this.fps,this._frameTime="number"==typeof a.delay?-a.delay:0,this._totalFrames="number"==typeof a.totalFrames?a.totalFrames:1,this.prepend="string"==typeof a.prepend?a.prepend:"",this.rewind="boolean"==typeof a.rewind&&a.rewind,this.init(),this._updateFrames=this._updateFrames.bind(this),this.addUpdate(this._updateFrames.bind(this))},CMP.ImageSequence.prototype={init:function(a){this.charImage=this.addChild(new CMP.Sprite({alpha:0,layout:{xPercentage:.5,yPercentage:.5,scaleToWidth:1,scaleToHeight:1}}))},_drawFrame:function(){if(this.charImage.alpha=1,"number"==typeof this._currentFrame){var a=this._currentFrame%this._totalFrames;this.startAtOne&&a++;var b=this.addZero&&a<=9?"0":"",c=this.prepend+b+a;this.charImage.setImage(c),this.debug&&this.visible&&console.log(this.prepend,this._currentFrame)}},_updateFrames:function(a){var b=a.delta;if(this.backwards)return void this.backwardsUpdate(b);if(!this._playing)return this.endAt0&&(this._currentFrame=0),void this._drawFrame();if(this._markedForRemoval)return void CMP.App.removeUpdate(this._updateFrames);this._playing&&(this._frameTime+=b/1e3);for(var c=this._currentFrame;this._frameTime>1/this.fps;){if(this._frameTime-=1/this.fps,++this._currentFrame>=this._totalFrames)if("number"==typeof this.loop){if(0===--this.loop)return void this.sequenceComplete();this.rewind&&(this.backwards=!0,this._currentFrame=this._totalFrames-1)}else this.loop?this.rewind?(this.backwards=!0,this._currentFrame=this._totalFrames-1):this._currentFrame=0:this.rewind?(this.backwards=!0,this._currentFrame=this._totalFrames-1):this.sequenceComplete();this._currentFrame=this._currentFrame%this._totalFrames}c!==this._currentFrame&&this._drawFrame()},sequenceComplete:function(){this._currentFrame--,this._playing=!1,"function"==typeof this.onComplete&&(this.onComplete(),this.onComplete=!1),this.removeOnEnd&&this.markForRemoval(),this._drawFrame()},backwardsUpdate:function(a){if(!this._playing)return this._currentFrame=this._totalFrames-1,void this._drawFrame();if(this._markedForRemoval)return void CMP.App.removeUpdate(this._updateFrames);this._playing&&(this._frameTime+=a/1e3);for(var b=this._currentFrame;this._frameTime>1/this.fps;)if(this._frameTime-=1/this.fps,--this._currentFrame<0){if(!this.loop)return this.rewind?(this.backwards=!1,this._currentFrame=0,this._drawFrame(),this._frameTime=0,this._playing=!1,void(this.onComplete&&(this.onComplete(),this.onComplete=!1))):(this._currentFrame++,this._frameTime=0,this._playing=!1,this.onComplete&&(this.onComplete(),this.onComplete=!1),this.removeOnEnd&&this.markForRemoval(),void this._drawFrame());this.rewind?(this.backwards=!1,this._currentFrame=0):this._currentFrame=this._totalFrames-1}b!==this._currentFrame&&this._drawFrame()},playFromStart:function(){this._currentFrame=0,this.play()},play:function(){0===this.loop&&(this.loop=1),this._playing=!0,this._drawFrame()},playFromFrame:function(a){this._currentFrame=a,this.play()},playFromEnd:function(){this._currentFrame=this._totalFrames-1,this.backwards=!0,this.play()}},extend("CMP.ImageSequence","CMP.DisplayObjectContainer");