CMP.HeatViewer=function(){AppConfig&&AppConfig.GAME_ID&&AppConfig.VERSION&&(this.id=AppConfig.GAME_ID,this.version=AppConfig.VERSION,this.grid=[],this.elapsedTime=0,this.touchIndex=0,this.sectionIndex=0,this.touchPattern=[],this.sortedSections=[],this.width=10*Math.floor(CMP.App.stage.width/10+.99),this.height=10*Math.floor(CMP.App.stage.height/10+.99),this.getRemote())},CMP.HeatViewer.prototype={progress:function(a){this.sectionIndex++,this.sectionName=a,this.elapsedTime=0,this.touchIndex=0},getRemote:function(){var a=new XMLHttpRequest;a.addEventListener("load",this.onComplete.bind(this));var b={id:this.id,version:this.version};b=JSON.stringify(b),b=btoa(b),a.open("GET","https://cmp-automator.herokuapp.com/heatContent/?r="+b),a.send()},onComplete:function(a){var b=a.target.responseText;"["!==b[0]&&(b=atob(b)),this.touchPattern=JSON.parse(b),this.init(),CMP.App.addUpdate(this.onUpdate.bind(this))},init:function(){for(var a=0;a<this.touchPattern.length;a++){var b=this.touchPattern[a],c=b.section;b.sectionName&&(c=b.sectionName),this.sortedSections[c]||(this.sortedSections[c]=[]),this.sortedSections[c].push(b)}for(var d=0;d<this.sortedSections.length;d++)this.quickSort("time",this.sortedSections[d]);this.setupGrid()},setupGrid:function(){var a=CMP.App.stage.addChild(new CMP.DisplayObjectContainer({width:this.width,height:this.height,layout:"fill"}));CMP.App.addUpdate(function(){if(this.parent&&this.parent.children){this.parent.children.push(this);for(var a=this.parent.children.length-2;a>=0;a--)if(this.parent.children[a]===this)return void this.parent.children.splice(a,1)}}.bind(a));for(var b=this.width/10,c=this.height/10,d=0;d<b;d++){this.grid.push([]);for(var e=0;e<c;e++)this.grid[d][e]=a.addChild(new CMP.DisplayObjectContainer({backgroundColor:this.RGB2HTML(0,0,255),alpha:.5,width:10,height:10,x:10*d,y:10*e})),this.grid[d][e].heatValue=0}},RGB2HTML:function(a,b,c){return"#"+(16777216+c+256*b+65536*a).toString(16).substr(1)},swap:function(a,b,c){var d=a[b];a[b]=a[c],a[c]=d},partition:function(a,b,c,d){for(var e=b[Math.floor((d+c)/2)][a],f=c,g=d;f<=g;){for(;b[f][a]<e;)f++;for(;b[g][a]>e;)g--;f<=g&&(this.swap(b,f,g),f++,g--)}return f},quickSort:function(a,b,c,d){var e;return b.length>1&&(c="number"!=typeof c?0:c,d="number"!=typeof d?b.length-1:d,e=this.partition(a,b,c,d),c<e-1&&this.quickSort(a,b,c,e-1),e<d&&this.quickSort(a,b,e,d)),b},target:function(a,b,c){var d=Math.floor(this.grid.length*a),e=Math.floor(this.grid[0].length*b);this.heatUp(d,e,c)},heatUp:function(a,b,c){if(!(c<=0)&&this.grid[a]&&this.grid[a][b]){if(this.grid[a][b].hasBeenHeated){if(this.grid[a][b].hasBeenHeated>=c)return;this.grid[a][b].heatValue-=this.grid[a][b].hasBeenHeated}this.grid[a][b].hasBeenHeated=c,this.grid[a][b].visible=!0,this.grid[a][b].heatValue+=c,this.grid[a][b].heatValue=Math.min(1020,this.grid[a][b].heatValue);var d=Math.max(100,.2*c);this.heatUp(a-1,b-1,c-d),this.heatUp(a-1,b,c-d),this.heatUp(a-1,b+1,c-d),this.heatUp(a,b-1,c-d),this.heatUp(a,b+1,c-d),this.heatUp(a+1,b-1,c-d),this.heatUp(a+1,b,c-d),this.heatUp(a+1,b+1,c-d)}},onUpdate:function(a){this.degradeHeat(a.delta);var b=this.sectionName?this.sectionName:this.sectionIndex;if(this.sortedSections[b]&&!(this.sortedSections[b].length<=this.touchIndex)){this.elapsedTime+=a.delta;var c=this.sortedSections[b][this.touchIndex],d=c.time;if(this.elapsedTime>d){this.clearHasBeenHeated();var e=c.x/c.width,f=c.y/c.height;this.target(e,f,720),this.touchIndex++}}},clearHasBeenHeated:function(a){for(var b=0;b<this.grid.length;b++)for(var c=0;c<this.grid[b].length;c++)this.grid[b][c].hasBeenHeated=0},degradeHeat:function(a){for(var b=0;b<this.grid.length;b++)for(var c=0;c<this.grid[b].length;c++){var d=this.grid[b][c];d.heatValue-=a,d.heatValue=Math.max(0,d.heatValue);var e=255,f=255,g=255;d.heatValue>=765?(f=1020-d.heatValue,g=0):d.heatValue>=510?(e=d.heatValue-510,g=0):d.heatValue>=255?(e=0,g=510-d.heatValue):(e=0,f=d.heatValue),e=Math.floor(e),f=Math.floor(f),g=Math.floor(g),d.backgroundColor=this.RGB2HTML(e,f,g),d.heatValue}}};